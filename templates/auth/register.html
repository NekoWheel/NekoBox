{{template "base/header" .}}
<script>
    function onSendCode(recaptcha){
      fetch('/api/v1/register/send-sms', {
          method: 'POST',
          headers: {
              'Content-Type': 'application/json',
              'X-CSRF-Token': _csrf,
          },
          body: JSON.stringify({
              phone: document.getElementById('phone').value,
              recaptcha: recaptcha,
          }),
      }).then((res) => {
          res.json().then((data) => {
              if(res.status === 200){
                  alert(data.data)
              } else {
                  alert(data.message)
              }
          })
      }).catch(() => {
          alert('验证码发送失败，请稍后重试')
      })
    }

    function onSubmitRegister(){
      const textarea = document.querySelector("#sms-code textarea");
      if(textarea){
        textarea.parentNode.removeChild(textarea);
      }
      document.getElementById('form').submit();
    }
</script>

<form method="post" id="form">
  {{ .CSRFTokenHTML }}
  <fieldset class="uk-fieldset">
    <legend class="uk-legend">新用户注册</legend>
    {{template "base/alert" .}}
    <div class="uk-margin">
      <label class="uk-form-label">电子邮箱地址</label>
      <input name="email" class="uk-input" type="text" value="{{.email}}">
    </div>
    <div class="uk-margin">
      <label class="uk-form-label">个性域名 (你的问答箱网址将会是：
        <code>{{.ExternalURL}}/_/</code> + 你在下面文本框中填写的内容)</label>
      <input name="domain" class="uk-input" type="text" value="{{.domain}}">
    </div>
    <div class="uk-margin">
      <label class="uk-form-label">手机号、短信验证码 (可选，若不验证手机号，则<b>提问箱将不会公开展示所有已回答的问题列表</b>）</label>
      <div class="uk-margin" uk-margin>
        <div uk-form-custom="target: true">
          <input id="phone" name="phone" class="uk-input" type="text" value="{{.phone}}" placeholder="手机号">
        </div>
        <div id="sms-code" uk-form-custom="target: true">
          <button type="button" class="uk-button uk-button-default g-recaptcha" data-sitekey="{{.RecaptchaSiteKey}}" data-callback="onSendCode">发送验证码</button>
        </div>
        <div uk-form-custom="target: true">
          <input name="verify_code" class="uk-input" type="text" placeholder="短信验证码">
        </div>
      </div>
    </div>
    <div class="uk-margin">
      <label class="uk-form-label">昵称</label>
      <input name="name" class="uk-input" type="text" value="{{.name}}">
    </div>
    <div class="uk-margin">
      <label class="uk-form-label">密码</label>
      <input type="password" name="password" class="uk-input" type="text">
    </div>
    <div class="uk-margin">
      <label class="uk-form-label">确认密码</label>
      <input type="password" name="repeat_password" class="uk-input" type="text">
    </div>
    <div class="uk-margin">
      <button type="submit" class="uk-button uk-button-primary g-recaptcha" data-sitekey="{{.RecaptchaSiteKey}}"
              data-callback="onSubmitRegister">注册
      </button>
    </div>
  </fieldset>
</form>
{{template "base/footer" .}}
